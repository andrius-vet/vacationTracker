import{r as i,j as e}from"./jsx-runtime-DSTfpXA4.js";import{s as u}from"./supabaseClient-D5N2WE3t.js";import{n as E}from"./index-DvkXgWiQ.js";const f=l=>{const r=new Date(l),o=r.getFullYear(),c=String(r.getMonth()+1).padStart(2,"0"),s=String(r.getDate()).padStart(2,"0");return`${o}-${c}-${s}`};function q({onLeaveSubmit:l}){const[r,o]=i.useState(""),[c,s]=i.useState(""),[x,p]=i.useState("annual"),[h,y]=i.useState("pending"),b=async a=>{var D,S;a.preventDefault();const{data:t,error:n}=await u.auth.getSession();if(n){console.error("Session error:",n),alert(`Session error: ${n.message}`);return}if(console.log("Session data:",t),!((S=(D=t==null?void 0:t.session)==null?void 0:D.user)!=null&&S.id)){console.error("User ID not found in session"),alert("User ID not found in session. Please log in again.");return}const d=t.session.user.id;if(console.log("User ID:",d),!r||!c){alert("Please select both start and end dates.");return}const m=new Date(r),N=new Date(c);if(m>N){alert("End date must be after start date.");return}const L=v(r,c),w={user_id:d,start_date:f(r),end_date:f(c),type:x,status:h,leave_days:L};console.log("New leave object:",w);try{const{data:g,error:j}=await u.from("vacation_requests").insert([w]).select();j?(console.error("Supabase error:",j),alert(`Failed to submit leave request: ${j.message}`)):(console.log("Leave request submitted successfully:",g),alert("Leave request submitted successfully!"),l&&l(),o(""),s(""),p("annual"),y("pending"))}catch(g){console.error("Unexpected error:",g),alert(`Unexpected error: ${g.message}`)}},v=(a,t)=>{const n=new Date(a);return(new Date(t).getTime()-n.getTime())/(1e3*60*60*24)+1};return e.jsxs("div",{className:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4",children:[e.jsx("h2",{className:"block text-gray-700 text-lg font-bold mb-3",children:"Request Vacation"}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"startDate",children:"Start Date"}),e.jsx("input",{type:"date",id:"startDate",value:r,onChange:a=>o(a.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"endDate",children:"End Date"}),e.jsx("input",{type:"date",id:"endDate",value:c,onChange:a=>s(a.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"leaveType",children:"Leave Type"}),e.jsxs("select",{id:"leaveType",value:x,onChange:a=>p(a.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",children:[e.jsx("option",{value:"annual",children:"Annual Leave"}),e.jsx("option",{value:"sick",children:"Sick Leave"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",type:"submit",children:"Request Leave"})})]})]})}function T({leaves:l,isAdmin:r,onApprove:o,onReject:c}){return e.jsxs("div",{className:"bg-white shadow-md rounded my-6",children:[e.jsx("h2",{className:"block text-gray-700 text-lg font-bold mb-3 px-8 pt-6",children:"Your last leaves"}),e.jsxs("table",{className:"min-w-max w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200 text-gray-600 uppercase text-sm leading-normal",children:[e.jsx("th",{className:"py-3 px-6 text-left",children:"Date From"}),e.jsx("th",{className:"py-3 px-6 text-left",children:"Date To"}),e.jsx("th",{className:"py-3 px-6 text-left",children:"Type"}),e.jsx("th",{className:"py-3 px-6 text-left",children:"State"}),e.jsx("th",{className:"py-3 px-6 text-left",children:"Leave Days"}),e.jsx("th",{className:"py-3 px-6 text-left",children:"Status"}),r&&e.jsx("th",{className:"py-3 px-6 text-left",children:"Actions"})]})}),e.jsx("tbody",{className:"text-gray-600 text-sm font-light",children:l.map((s,x)=>e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-100",children:[e.jsx("td",{className:"py-3 px-6 text-left whitespace-nowrap",children:f(s.start_date)}),e.jsx("td",{className:"py-3 px-6 text-left whitespace-nowrap",children:f(s.end_date)}),e.jsx("td",{className:"py-3 px-6 text-left",children:"Annual Leave"}),e.jsx("td",{className:"py-3 px-6 text-left",children:e.jsx("span",{className:"bg-green-200 text-green-600 py-1 px-3 rounded-full text-xs",children:s.status})}),e.jsx("td",{className:"py-3 px-6 text-left",children:$(s.start_date,s.end_date)}),e.jsx("td",{className:"py-3 px-6 text-left",children:e.jsx("div",{className:"flex items-center",children:e.jsx("span",{children:s.status})})}),r&&e.jsx("td",{className:"py-3 px-6 text-left",children:s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>o(s.id),className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mr-2",children:"Approve"}),e.jsx("button",{onClick:()=>c(s.id),className:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded",children:"Reject"})]})})]},x))})]})]})}function $(l,r){const o=new Date(l);return(new Date(r).getTime()-o.getTime())/(1e3*60*60*24)+1}function k({days:l}){return e.jsxs("div",{className:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4",children:[e.jsx("h2",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Total days left"}),e.jsx("p",{className:"text-3xl font-bold text-gray-800",children:l})]})}const F=()=>[{title:"Vacation Manager"},{name:"description",content:"Manage your vacations easily"}];function I(){const[l,r]=i.useState([]),[o,c]=i.useState(null),[s,x]=i.useState(!1),p=E();i.useEffect(()=>{(async()=>{const{data:{session:t}}=await u.auth.getSession();if(t){c(t.user.id);const{data:n,error:d}=await u.from("profiles").select("role").eq("id",t.user.id).single();d?(console.error("Error fetching profile:",d),alert(`Error fetching profile: ${d.message}`)):x((n==null?void 0:n.role)==="admin")}else p("/auth")})()},[p]),i.useEffect(()=>{o&&h(o,s)},[o,s]);const h=async(a,t)=>{try{let n=u.from("vacation_requests").select("*");t||(n=n.eq("user_id",a));const{data:d,error:m}=await n;m?(console.error("Error fetching leaves:",m),alert(`Error fetching leaves: ${m.message}`)):(r(d||[]),console.log("Fetched leaves:",d))}catch(n){console.error("Unexpected error fetching leaves:",n),alert(`Unexpected error fetching leaves: ${n.message}`)}},y=async()=>{const{error:a}=await u.auth.signOut();a?(console.error("Logout error:",a),alert(`Logout error: ${a.message}`)):p("/auth")},b=async a=>{try{const{error:t}=await u.from("vacation_requests").update({status:"approved"}).eq("id",a);t?(console.error("Error approving leave:",t),alert(`Error approving leave: ${t.message}`)):h(o,s)}catch(t){console.error("Unexpected error approving leave:",t),alert(`Unexpected error approving leave: ${t.message}`)}},v=async a=>{try{const{error:t}=await u.from("vacation_requests").update({status:"rejected"}).eq("id",a);t?(console.error("Error rejecting leave:",t),alert(`Error rejecting leave: ${t.message}`)):h(o,s)}catch(t){console.error("Unexpected error rejecting leave:",t),alert(`Unexpected error rejecting leave: ${t.message}`)}};return e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Overview"}),e.jsx("button",{className:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded mb-4",onClick:y,children:"Logout"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"col-span-2",children:e.jsx(q,{onLeaveSubmit:()=>h(o,s)})}),e.jsx("div",{children:e.jsx(k,{days:"16.12"})})]}),e.jsx(T,{leaves:l,isAdmin:s,onApprove:b,onReject:v})]})}export{I as default,F as meta};
